
		/*
 * Copyright (C) 2007 Trivantis Corporation
 */

	
TTPr.StartInteractions=function(A){var B=this.findTestPage(A);if(B>=0&&this.arRTPages[B].startInteractions()) return B;return-1;};TTPr.SetInteraction=function(A,B){if(B>=0) this.arRTPages[B].setInteraction(A);};TTPr.HandleInteractions=function(A,B,C,D,E,F,G){var i;for(i=0;i<this.arRTPages.length;i++) this.arRTPages[i].handleInteractions(A,B,C,D,E,F,G);return;};TPPr.startInteractions=function(){if(this.arQues.length==1){this.dateInt=new Date();this.lIntST=this.dateInt.getTime();this.lIntET=0;return true;}else{this.dateInt=null;this.lIntST=0;this.lIntET=0;return false;}};TPPr.setInteraction=function(A){if(this.lIntST>0){if(this.arQues.length==1&&this.arQues[0].varName==A){var B=new Date().getTime();this.lIntET+=(B-this.lIntST);this.lIntST=B;}}};TPPr.handleInteractions=function(A,B,C,D,E,F,G){var i;for(i=0;i<this.arQues.length;i++){this.arQues[i].handleInteractions(A,B,C,D,this.lIntET,this.dateInt,E,F,G);this.lIntET=0;};return;};function intDateForm(A,B,C){var D="";if(C) D+=A.getUTCFullYear();else D+=A.getFullYear();var E=B?"-":"/";D+=E;var F;if(C) F=A.getUTCMonth()+1;else F=A.getMonth()+1;if(F<10) D+="0";D+=F+E;if(C) F=A.getUTCDate();else F=A.getDate();if(F<10) D+="0";D+=F;return D;};function intTimeForm(A,B,C){var D="";var E=":";var F;if(B){if(C) F=A.getUTCHours();else F=A.getHours();}else{F=parseInt(A/3600000,10);A-=F*3600000;};if(F<10) D+="0";D+=F+E;if(B){if(C) F=A.getUTCMinutes();else F=A.getMinutes();}else{F=parseInt(A/60000,10);A-=F*60000;};if(F<10) D+="0";D+=F+E;if(B){if(C) F=A.getUTCSeconds();else F=A.getSeconds();}else F=parseInt(A/1000,10);if(F<10) D+="0";D+=F;if(C) D+="Z";return D;};var letArr="ABCDEFGHIJKLMNOPQRSTUVWXYZ";TQPr.handleInteractions=function(A,B,C,D,E,F,G,H,I){var J=this;if(J.type==-1) return A.str;var K=null,L=null,M=null,N=null,O=null,P=null,Q=null,R=null,S=null,T=null,U=null,W=null,X=null,Y=null,Z=0,a=0,b,c=1,d=0,e=0,f=0,i,h=false,k,l=new Date(),m=l.getTime(),n,o=false,p=false,q=getTitleMgrHandle(),r=(G==2013);if((J.type==6||J.type==7||J.type==2||J.type==9)&&J.bGradeInd){if(J.type==2||J.type==9) c=J.arChoices.length;else{for(e=J.corrAns.indexOf(',');e!=-1;e=J.corrAns.indexOf(',',e+1)) c++;};h=true;E/=c;};K=(J.name+"_").replace(/['" ~]/g,'_');L=K;M=m;for(n=0;n<c;n++){K=L;b=true;switch(J.type){case 1:N="true-false";if(G==2013||I){O=(J.choices.indexOf(J.corrAns)==0?'true':'false');P=(J.choices.indexOf(J.strOurAns)==0?'true':'false');}else if(G==2004){O=J.corrAns.toLowerCase();P=J.strOurAns.toLowerCase();}else{O=J.corrAns;P=J.strOurAns;};K+=J.id;break;case 10:N="likert";O="";P="";var s={},t=J.strOurAns.split(",");trivArExec(t,function(AG){s[AG.split("-")[0]]=AG.split("-")[1];});trivArExec(J.arStatements,function(AH,AI){var w=s[AI+1];P+=(AI!=0?",":"")+(w!=undefined?w:"");});K+=J.id;break;case 2:case 9:case 11:case 14:N=(J.type==11?"sequencing":"choice");if((J.bAllowMult||J.type==11)&&G==0){O="{";P="{";}else{O="";P="";};d=1;for(e=J.choices.indexOf('|');e!=-1;e=J.choices.indexOf('|',e+1)) d++;U=addDelimeter(J.arChoices,J.strOurAns,"|||");W=addDelimeter(J.arChoices,J.corrAns,"|||");if(J.type==11){for(j=0;j<d;j++){a=U.indexOf(',',Z+1);if(a!=-1) Y=U.substring(Z,a+1);else Y="";e=0;for(i=0;i<d;i++){f=J.choices.indexOf('|',e);var x=J.choices.substring(e,(f>=0?f:null));X="|||"+x+"|||";if(X==Y){if(P.length>0){if(G>=2004) P+="[,]";else P+=",";};if(G==2013) P+=x;else P+=letArr.charAt(i);};e=f+1;};Z=a;}}else{if(h&&(J.type==2||J.type==9)){o=IsChoiceSelected(J.arChoices[n],J.strOurAns);p=J.isCorrectSub(J.arChoices[n]);if(o){if(G==2013) P+=J.arChoices[n];else P+=letArr.charAt(n);}else P+="";if(p){if(G==2013) O+=J.arChoices[n];else O+=letArr.charAt(n);}}else{e=0;for(i=0;i<d;i++){f=J.choices.indexOf('|',e);var x=J.choices.substring(e,(f>=0?f:u));X="|||"+x+"|||";if(W.indexOf(X)>=0){if(O.length>0){if(J.bAllowMult&&G>=2004) O+="[,]";else O+=",";};if(G==2013) O+=x;else O+=letArr.charAt(i);};if(U.indexOf(X)>=0){if(P.length>0){if((J.bAllowMult||J.type==11)&&G>=2004) P+="[,]";else P+=",";};if(G==2013) P+=x;else P+=letArr.charAt(i);};e=f+1;}}};if((J.bAllowMult||J.type==11)&&G==0){O+="}";P+="}";};if(h&&(J.type==2||J.type==9)) K+=J.id+"-"+(n+1);else K+=J.id;break;case 5:N="fill-in";e=J.corrAns.indexOf('|');if(e>=0) O=J.corrAns.substring(0,e);else O=J.corrAns;P=J.strOurAns;K+=J.id;break;case 13:if(J.arRel.length==1&&parseInt(J.arRel[0])==1){N="numeric";O=J.arCorrAns[0];}else{N="fill-in";O="";var AB;if(J.bAnyAnswer) AB=" "+trivstrOr+" ";else AB=" "+trivstrAnd+" ";var y=0;for (var i=0;i<J.arRel.length;i++){if(i>0) O+=AB;O+="(";switch (parseInt(J.arRel[i])){case 1:O+="n == "+J.arCorrAns[y];break;case 2:O+="n >= "+J.arCorrAns[y]+" && n <= "+J.arCorrAns[y+1];y++;break;case 3:O+="n > "+J.arCorrAns[y]+" && n < "+J.arCorrAns[y+1];y++;break;case 4:O+="n > "+J.arCorrAns[y];break;case 5:O+="n >= "+J.arCorrAns[y];break;case 6:O+="n < "+J.arCorrAns[y];break;case 7:O+="n <= "+J.arCorrAns[y];break;case 8:O+="n != "+J.arCorrAns[y];break;};y++;O+=")";};if(O.length>255) O=O.replace(/ /g,'');};P=J.strOurAns;K+=J.id;break;case 3:case 4:N="fill-in";O="";P=J.strOurAns;K+=J.id;b=false;break;case 6:case 7:N="matching";P="";var AC=J.strOurAns.split(",");if(h){if(J.arCorrAns.length<=n&&AC.length<=n) continue;if(G==2013){X="0-0";if(J.arCorrAns.length>n) X=J.arCorrAns[n];O+=X.replace(/-/,"[.]");X="0-0";if(AC.length>n) X=AC[n];P+=X.replace(/-/,"[.]");}else{if(n<J.arCorrAns.length) O=(n+1);else O="0";if(G>=2004) O+="[.]";else O+=".";if(n<J.arCorrAns.length) O+=letArr.charAt(n);else O+="0";X="";if(AC.length>n){X=AC[n];P=(n+1);if(G>=2004) P+="[.]";else P+=".";e=X.indexOf('-');if(e>=0){X=X.substring(e+1);for(i=0;i<J.arAddedInfo.length;i++){if(J.arAddedInfo[i]==X){P+=letArr.charAt(i);break;}};if(i>=J.arAddedInfo.length) P+="0";}}};K+=J.id+"-"+(n+1);}else{if(G>0){O="";P="";}else{O="{";P="{";};for(i=0;i<J.arCorrAns.length;i++){if(i>0){if(G>=2004) O+="[,]";else O+=",";};if(G==2013){X=J.arCorrAns[i];O+=X.replace(/-/,"[.]");}else{X=(i+1);if(G>=2004) X+="[.]";else X+=".";X+=letArr.charAt(i);O+=X;}};for(i=0;i<AC.length;i++){if(i>0){if(G>=2004) P+="[,]";else P+=",";};if(G==2013){X=AC[i];P+=X.replace(/-/,"[.]");}else{e=AC[i].indexOf('-');if(e>=0){x=AC[i].substring(e+1);X=AC[i].substring(0,e);for(var AD=0;AD<J.arChoices.length;AD++){if(J.arChoices[AD]==X){P+=(AD+1);break;}};if(AD>=J.arChoices.length) P+="0";if(G>=2004) P+="[.]";else P+=".";for(AD=0;AD<J.arAddedInfo.length;AD++){if(J.arAddedInfo[AD]==x){P+=letArr.charAt(AD);break;}};if(AD>=J.arAddedInfo.length) P+="0";}}};if(G==0){O+="}";P+="}";};if (G<2004) P=P.replace(/^[,]+/,'').replace(/[,]+$/,'').replace(/[,]+/g,',');K+=this.id;};break;default:N="";O="";P="";break;};if(J.bSurvey){O="";b=false;};if(q.bIntTS){K+="_";K+=M;};if(b){if(h){if(J.type==2||J.type==9){if((o&&p)||(!o&&!p)) k=1;else k=0;}else{X=GetMatchingPairStr(n,J.strOurAns);k=J.isCorrect(n,X);}}else k=J.isCorrect();if(k!=0) Q="correct";else{if(G>=2004) Q="incorrect";else Q="wrong";}}else Q="neutral";if(F!=null){if(G>=2004){T=intDateForm(F,1,r);T+="T";T+=intTimeForm(F,1,r);}else T=intTimeForm(F,1,r);S=intDateForm(F,0,r);}else{var AE=intDateForm(l,0,r);var AF;if(G>=2004){AF=intDateForm(l,1,r);AF+="T";AF+=intTimeForm(l,1,r);}else AF=intTimeForm(l,1,r);T=AF;S=AE;};if(F==null) R="";else R=intTimeForm(E,0,r);if (h&&!O&&O!==0) O="";if (!(G>=2004&&(J.type==6||J.type==7))){if (O.length>255) O=O.substring(0,254);};O=convJS(O);if(P!=null&&P.length>0){if (!(G>=2004&&(J.type==6||J.type==7))){if (P.length>255) P=P.substring(0,254);};P=convJS(P);};X=null;if(H){X=J.text;if(X!=null&&X.length>0) X=convJS(X);};if(G>0) putSCORMInteractions(K,null,T,N,O,J.weight,P,Q,R,X);else{if(A.str.length==0){A.add('"course_id","student_id","lesson_id","date","time","interaction_id","objective_id","type_interaction","correct_response","student_response","result","weighting","latency"');if(H) A.add(',"text"');A.add('\n');};A.add('"'+B+'",');A.add('"'+C+'",');A.add('"'+D+'",');A.add('"'+S+'",');A.add('"'+T+'",');A.add('"'+K+'",');A.add('"",');A.add('"'+N+'",');A.add('"'+O+'",');A.add('"'+P+'",');A.add('"'+Q+'",');A.add('"'+J.weight+'",');A.add('"'+R+'"');if(H) A.add(',"'+X+'"');A.add('\n');}};return A.str;};function convJS(s){if(s==null) return '';s=s.replace(/\n/g,'<br/>');s=s.replace(/\\r/g,'<br/>');s=s.replace(/"/g,'&quot;');return s;};function addDelimeter(A,B,C){var D="";if(B!=null&&B!=""){var E="",F,G=","+B+",";for(var i=0;i<A.length;i++){E=","+A[i]+",";F=G.indexOf(E);if(F!=-1){if(D.length==0) D=C;D+=A[i]+C;}}};return D;};
